<!DOCTYPE html>
<html lang="en">
<head>
    <title>js13k</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #gameCanvas {
            border: 1px solid black;
            margin: 20px auto;
            display: block;
        }
        #gameInfo {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        button {
            margin: 10px;
        }
    </style>
</head>
<body>
<h1>js13kgame -13 maze</h1>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<div id="gameInfo">
    <p>CNT: <span id="score">0</span></p>
    <p>HP: <span id="health">10</span></p>
    <p>HINT: <span id="hints">3</span></p>
    <p id="gameStatus"></p>
</div>
<button onclick="useHint()">HINT</button>

<script>
    const canvas = document.getElementById('gameCanvas');
    const context = canvas.getContext('2d');
    const scoreDisplay = document.getElementById('score');
    const healthDisplay = document.getElementById('health');
    const hintsDisplay = document.getElementById('hints');
    const gameStatus = document.getElementById('gameStatus');

    const mazeSize = 8;
    const cellSize = 50;
    let playerPosition = { x: 0, y: 0 };
    let currentScore = 0;
    let playerHealth = 10;
    let hintsAvailable = 3;
    let showHint = false;

    const exitPosition = { x: mazeSize - 1, y: mazeSize - 1 };

    const maze = Array.from({ length: mazeSize }, () =>
        Array.from({ length: mazeSize }, () => {
            const num = Math.floor(Math.random() * 8) - 3;
            return num === 0 ? 1 : num;
        })
    );

    function drawMaze() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < mazeSize; i++) {
            for (let j = 0; j < mazeSize; j++) {
                context.fillStyle = 'lightgray';
                context.fillRect(j * cellSize, i * cellSize, cellSize, cellSize);
                context.strokeRect(j * cellSize, i * cellSize, cellSize, cellSize);

                if (showHint && Math.abs(playerPosition.x - j) <= 1 && Math.abs(playerPosition.y - i) <= 1) {
                    context.fillStyle = 'black';
                    context.font = '16px Arial';
                    context.textAlign = 'center';
                    context.textBaseline = 'middle';
                    context.fillText(maze[i][j], j * cellSize + cellSize / 2, i * cellSize + cellSize / 2);
                }
            }
        }

        context.fillStyle = 'green';
        context.fillRect(exitPosition.x * cellSize, exitPosition.y * cellSize, cellSize, cellSize);

        context.fillStyle = 'blue';
        context.fillRect(playerPosition.x * cellSize, playerPosition.y * cellSize, cellSize, cellSize);
    }

    function updateScore(newScore) {
        currentScore += newScore;
        scoreDisplay.textContent = currentScore;
        healthDisplay.textContent = playerHealth;

        if (currentScore >= 13 || playerHealth <= 0) {
            gameOver();
        } else if (playerPosition.x === exitPosition.x && playerPosition.y === exitPosition.y) {
            // 도착지 왔을때 처리 추가 필요(ex : 다음단계로 넘어가거나 크래딧)
            gameStatus.textContent = 'end.';
            document.removeEventListener('keydown', handleKeyPress);
        }
    }

    function gameOver() {
        gameStatus.textContent = 'Game Over!';
        resetGame();
        setTimeout(() => {
            gameStatus.textContent = '';
            drawMaze();
        }, 2000);
    }

    function resetGame() {
        currentScore = 0;
        playerHealth = 10;
        hintsAvailable = 3;
        playerPosition = { x: 0, y: 0 };
        scoreDisplay.textContent = currentScore;
        healthDisplay.textContent = playerHealth;
        hintsDisplay.textContent = hintsAvailable;
        document.addEventListener('keydown', handleKeyPress);
    }

    function useHint() {
        if (hintsAvailable > 0) {
            hintsAvailable--;
            hintsDisplay.textContent = hintsAvailable;
            showHint = true;
            setTimeout(() => {
                showHint = false;
                drawMaze();
            }, 2000);
            drawMaze();
        }
    }

    function handleKeyPress(event) {
        const { x, y } = playerPosition;
        if (event.key === 'ArrowUp' && y > 0) playerPosition.y -= 1;
        if (event.key === 'ArrowDown' && y < mazeSize - 1) playerPosition.y += 1;
        if (event.key === 'ArrowLeft' && x > 0) playerPosition.x -= 1;
        if (event.key === 'ArrowRight' && x < mazeSize - 1) playerPosition.x += 1;

        const newScore = maze[playerPosition.y][playerPosition.x];
        playerHealth -= 1;
        updateScore(newScore);
        drawMaze();
    }

    document.addEventListener('keydown', handleKeyPress);
    drawMaze();
</script>
</body>
</html>
